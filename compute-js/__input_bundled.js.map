{
  "version": 3,
  "sources": ["fastly:env", "fastly:kv-store", "fastly:config-store", "node_modules/@fastly/compute-js-static-publish/build/models/compression/index.js", "node_modules/@fastly/compute-js-static-publish/build/models/assets/kvstore-assets.js", "node_modules/@fastly/compute-js-static-publish/build/server/util/kv-store.js", "node_modules/@fastly/compute-js-static-publish/build/server/publisher-server/serve-preconditions/if-modified-since.js", "node_modules/@fastly/compute-js-static-publish/build/server/publisher-server/serve-preconditions/if-none-match.js", "node_modules/@fastly/compute-js-static-publish/build/models/time/index.js", "node_modules/@fastly/compute-js-static-publish/build/server/publisher-server/index.js", "static-publish.rc.js", "src/index.js"],
  "sourcesContent": ["export const env = globalThis.fastly.env.get;", "export const KVStore = globalThis.KVStore;", "export const ConfigStore = globalThis.ConfigStore;", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\nexport const compressionTypes = [\n    'br',\n    'gzip',\n];\nexport function isCompressionType(value) {\n    return compressionTypes.includes(value);\n}\n", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\nimport { isCompressionType } from '../compression/index.js';\nexport function isKVAssetVariantMetadata(obj) {\n    if (obj == null || typeof obj !== 'object') {\n        return false;\n    }\n    if ('contentEncoding' in obj) {\n        if (typeof obj.contentEncoding !== 'string' ||\n            !isCompressionType(obj.contentEncoding)) {\n            return false;\n        }\n    }\n    if (!('size' in obj) || typeof obj.size !== 'number') {\n        return false;\n    }\n    if (!('hash' in obj) || typeof obj.hash !== 'string') {\n        return false;\n    }\n    if ('numChunks' in obj) {\n        if (typeof obj.numChunks !== 'number') {\n            return false;\n        }\n    }\n    return true;\n}\n", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\n// This is a custom KVStoreEntry implementation that is built by using a body and\n// metadataText passed in through the constructor. We piggyback off Response\n// for the utility functions such as json() and text().\nclass CustomKVStoreEntry extends Response {\n    constructor(body, metadataText) {\n        super(body);\n        this.metadataTextValue = metadataText;\n    }\n    get body() {\n        return super.body;\n    }\n    metadata() {\n        return new TextEncoder().encode(this.metadataTextValue);\n    }\n    metadataText() {\n        return this.metadataTextValue;\n    }\n}\nexport async function getKVStoreEntry(kvStore, key) {\n    const entry = await kvStore.get(key);\n    if (entry == null) {\n        return null;\n    }\n    const metadataText = entry.metadataText() ?? '';\n    if (metadataText === '') {\n        return entry;\n    }\n    let metadata;\n    try {\n        metadata = JSON.parse(metadataText);\n    }\n    catch {\n        return entry;\n    }\n    if (!('numChunks' in metadata) || typeof metadata.numChunks !== 'number') {\n        return entry;\n    }\n    if (metadata.numChunks < 2) {\n        return entry;\n    }\n    const streams = [\n        entry.body,\n    ];\n    for (let chunkIndex = 1; chunkIndex < metadata.numChunks; chunkIndex++) {\n        const chunkKey = `${key}_${chunkIndex}`;\n        const chunkEntry = await kvStore.get(chunkKey);\n        if (chunkEntry == null) {\n            throw new Error(`Missing chunk ${chunkKey}`);\n        }\n        streams.push(chunkEntry?.body);\n    }\n    const combinedStream = concatReadableStreams(streams);\n    return new CustomKVStoreEntry(combinedStream, metadataText);\n}\nfunction concatReadableStreams(streams) {\n    let currentStreamIndex = 0;\n    let currentReader = null;\n    return new ReadableStream({\n        async pull(controller) {\n            while (true) {\n                // If no current reader, get one from the next stream\n                if (!currentReader) {\n                    if (currentStreamIndex >= streams.length) {\n                        controller.close();\n                        return;\n                    }\n                    currentReader = streams[currentStreamIndex].getReader();\n                }\n                const { value, done } = await currentReader.read();\n                if (done) {\n                    currentReader.releaseLock();\n                    currentReader = null;\n                    currentStreamIndex++;\n                    continue; // Go to next stream\n                }\n                controller.enqueue(value);\n                return; // Let pull() be called again\n            }\n        },\n        async cancel(reason) {\n            if (currentReader) {\n                try {\n                    await currentReader.cancel(reason);\n                }\n                catch {\n                    // swallow\n                }\n            }\n        }\n    });\n}\n", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\n// https://httpwg.org/specs/rfc9110.html#field.if-modified-since\nexport function getIfModifiedSinceHeader(request) {\n    // A recipient MUST ignore the If-Modified-Since header field if the received\n    // field value is not a valid HTTP-date, the field value has more than one\n    // member, or if the request method is neither GET nor HEAD.\n    const headerValue = request.headers.get('If-Modified-Since');\n    if (headerValue == null || headerValue === '') {\n        return null;\n    }\n    const dateValueMs = Date.parse(headerValue);\n    if (Number.isNaN(dateValueMs)) {\n        // Date.parse returns NaN if the date cannot be parsed.\n        return null;\n    }\n    // We want to return this as a number of seconds;\n    return Math.floor(dateValueMs / 1000);\n}\nexport function checkIfModifiedSince(lastModifiedTime, ifModifiedSince) {\n    // 1. If the selected representation's last modification date is earlier or equal to the\n    // date provided in the field value, the condition is false.\n    if (lastModifiedTime <= ifModifiedSince) {\n        return false;\n    }\n    // 2. Otherwise, the condition is true.\n    return true;\n}\n", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\n// https://httpwg.org/specs/rfc9110.html#field.if-none-match\nexport function getIfNoneMatchHeader(request) {\n    return (request.headers.get('If-None-Match') ?? '')\n        .split(',')\n        .map(x => x.trim())\n        .filter(x => Boolean(x));\n}\nexport function checkIfNoneMatch(etag, headerValue) {\n    // 1. If the field value is \"*\", the condition is false if the origin server has a\n    // current representation for the target resource.\n    if (headerValue.includes('*')) {\n        return false;\n    }\n    // 2. If the field value is a list of entity tags, the condition is false if one of the listed tags matches the\n    // entity tag of the selected representation. A recipient MUST use the weak comparison function when comparing\n    // entity tags for If-None-Match (Section 8.8.3.2), since weak entity tags can be used for cache validation even\n    // if there have been changes to the representation data.\n    // But in our system we don't use weak tags, so we do a compare\n    if (headerValue.includes(etag)) {\n        return false;\n    }\n    // 3. Otherwise, the condition is true.\n    return true;\n}\n", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\nconst DURATION_MS = {\n    w: 604800000,\n    d: 86400000,\n    h: 3600000,\n    m: 60000,\n    s: 1000,\n    ms: 1,\n};\n// Parses something like \"1d2h30m\" or \"5m15s\" or \"150ms\"\nfunction parseDuration(durationStr) {\n    const regex = /(\\d+(?:\\.\\d+)?)(ms|[dhms])/g;\n    let totalMs = 0;\n    let matchedLength = 0;\n    for (const match of durationStr.matchAll(regex)) {\n        const [res, valueStr, unit] = match;\n        const value = parseFloat(valueStr);\n        totalMs += value * DURATION_MS[unit];\n        matchedLength += res.length;\n    }\n    if (matchedLength !== durationStr.length) {\n        throw new Error(`Invalid duration format: '${durationStr}'`);\n    }\n    return totalMs;\n}\nexport function calcExpirationTime({ expiresIn, expiresAt, expiresNever }) {\n    if ([expiresIn, expiresAt, expiresNever].filter(x => x !== undefined).length > 1) {\n        throw new Error('Only one of expiresIn or expiresAt or expiresNever may be provided');\n    }\n    if (expiresNever) {\n        return null;\n    }\n    if (expiresIn) {\n        const deltaMs = parseDuration(expiresIn);\n        console.log(`  \u23F3  Expiration duration '${expiresIn}' = ${deltaMs} ms`);\n        return Math.floor((Date.now() + deltaMs) / 1000); // return UNIX timestamp\n    }\n    if (expiresAt) {\n        const time = Date.parse(expiresAt);\n        if (isNaN(time)) {\n            throw new Error(`Invalid expiresAt value: '${expiresAt}'`);\n        }\n        console.log(`  \u23F0\uFE0F Expiration timestamp '${expiresAt}' = '${new Date(time)}'`);\n        console.log(`    \u2192 ${new Date(time).toISOString()}`);\n        return Math.floor(time / 1000);\n    }\n    return undefined;\n}\nexport function isExpired(unixTime) {\n    return unixTime < Math.floor(Date.now() / 1000);\n}\n", "/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n */\n/// <reference types=\"@fastly/js-compute\" />\nimport { KVStore } from 'fastly:kv-store';\nimport { isKVAssetVariantMetadata, } from '../../models/assets/kvstore-assets.js';\nimport { getKVStoreEntry } from '../util/kv-store.js';\nimport { checkIfModifiedSince, getIfModifiedSinceHeader } from './serve-preconditions/if-modified-since.js';\nimport { checkIfNoneMatch, getIfNoneMatchHeader } from './serve-preconditions/if-none-match.js';\nimport { isExpired } from \"../../models/time/index.js\";\nexport function buildHeadersSubset(responseHeaders, keys) {\n    const resultHeaders = new Headers();\n    for (const value of keys) {\n        if (value in responseHeaders) {\n            const responseHeaderValue = responseHeaders.get(value);\n            if (responseHeaderValue != null) {\n                resultHeaders.set(value, responseHeaderValue);\n            }\n        }\n    }\n    return resultHeaders;\n}\n// https://httpwg.org/specs/rfc9110.html#rfc.section.15.4.5\n// The server generating a 304 response MUST generate any of the following header fields that would have been sent in\n// a 200 (OK) response to the same request:\n// * Content-Location, Date, ETag, and Vary\n// * Cache-Control and Expires\nconst headersToPreserveForUnmodified = ['Content-Location', 'ETag', 'Vary', 'Cache-Control', 'Expires'];\nfunction requestAcceptsTextHtml(req) {\n    const accept = (req.headers.get('Accept') ?? '')\n        .split(',')\n        .map(x => x.split(';')[0]);\n    if (!accept.includes('text/html') && !accept.includes('*/*') && accept.includes('*')) {\n        return false;\n    }\n    return true;\n}\nexport class PublisherServer {\n    constructor(publishId, kvStoreName, defaultCollectionName) {\n        this.publishId = publishId;\n        this.kvStoreName = kvStoreName;\n        this.defaultCollectionName = defaultCollectionName;\n        this.activeCollectionName = this.defaultCollectionName;\n        this.collectionNameHeader = 'X-Publisher-Server-Collection';\n    }\n    static fromStaticPublishRc(config) {\n        return new PublisherServer(config.publishId, config.kvStoreName, config.defaultCollectionName);\n    }\n    setActiveCollectionName(collectionName) {\n        this.activeCollectionName = collectionName;\n        this.settingsCached = undefined;\n        this.kvAssetsIndex = undefined;\n    }\n    setCollectionNameHeader(collectionHeader) {\n        this.collectionNameHeader = collectionHeader;\n    }\n    // Server config is obtained from the KV Store, and cached for the duration of this object.\n    async getServerConfig() {\n        if (this.settingsCached !== undefined) {\n            return this.settingsCached;\n        }\n        const settingsFileKey = `${this.publishId}_settings_${this.activeCollectionName}`;\n        const kvStore = new KVStore(this.kvStoreName);\n        const settingsFile = await getKVStoreEntry(kvStore, settingsFileKey);\n        if (settingsFile == null) {\n            console.error(`Settings File not found at ${settingsFileKey}.`);\n            console.error(`You may need to publish your application.`);\n            this.settingsCached = null;\n        }\n        else {\n            this.settingsCached = (await settingsFile.json());\n        }\n        return this.settingsCached;\n    }\n    async getStaticItems() {\n        const serverConfig = await this.getServerConfig();\n        if (serverConfig == null) {\n            return [];\n        }\n        return serverConfig.staticItems\n            .map((x, i) => {\n            if (x.startsWith('re:')) {\n                const fragments = x.slice(3).match(/\\/(.*?)\\/([a-z]*)?$/i);\n                if (fragments == null) {\n                    console.warn(`Cannot parse staticItems item index ${i}: '${x}', skipping...`);\n                    return '';\n                }\n                return new RegExp(fragments[1], fragments[2] || '');\n            }\n            return x;\n        })\n            .filter(x => Boolean(x));\n    }\n    async getKvAssetsIndex() {\n        if (this.kvAssetsIndex !== undefined) {\n            return this.kvAssetsIndex;\n        }\n        const indexFileKey = `${this.publishId}_index_${this.activeCollectionName}`;\n        const kvStore = new KVStore(this.kvStoreName);\n        const indexFile = await getKVStoreEntry(kvStore, indexFileKey);\n        if (indexFile == null) {\n            console.error(`Index File not found at ${indexFileKey}.`);\n            console.error(`You may need to publish your application.`);\n            this.kvAssetsIndex = null;\n            return null;\n        }\n        let collectionIsExpired = false;\n        if (this.activeCollectionName !== this.defaultCollectionName) {\n            const metadataText = indexFile.metadataText();\n            if (metadataText != null) {\n                try {\n                    const metadata = JSON.parse(metadataText);\n                    collectionIsExpired = metadata.expirationTime != null && isExpired(metadata.expirationTime);\n                }\n                catch {\n                }\n            }\n        }\n        if (collectionIsExpired) {\n            console.error(`Requested collection expired at ${indexFileKey}.`);\n            this.kvAssetsIndex = null;\n            return null;\n        }\n        this.kvAssetsIndex = (await indexFile.json());\n        return this.kvAssetsIndex;\n    }\n    async getMatchingAsset(assetKey, applyAuto = false) {\n        const serverConfig = await this.getServerConfig();\n        if (serverConfig == null) {\n            return null;\n        }\n        const kvAssetsIndex = await this.getKvAssetsIndex();\n        if (kvAssetsIndex == null) {\n            return null;\n        }\n        if (!assetKey.endsWith('/')) {\n            // A path that does not end in a slash can match an asset directly\n            const asset = kvAssetsIndex[assetKey];\n            if (asset != null) {\n                return asset;\n            }\n            if (applyAuto) {\n                // ... or, we can try auto-ext:\n                // looks for an asset that has the specified suffix (usually extension, such as .html)\n                for (const extEntry of serverConfig.autoExt) {\n                    let assetKeyWithExt = assetKey + extEntry;\n                    const asset = kvAssetsIndex[assetKeyWithExt];\n                    if (asset != null) {\n                        return asset;\n                    }\n                }\n            }\n        }\n        if (applyAuto) {\n            if (serverConfig.autoIndex.length > 0) {\n                // try auto-index:\n                // treats the path as a directory, and looks for an asset with the specified\n                // suffix (usually an index file, such as index.html)\n                let assetNameAsDir = assetKey;\n                // remove all slashes from end, and add one trailing slash\n                while (assetNameAsDir.endsWith('/')) {\n                    assetNameAsDir = assetNameAsDir.slice(0, -1);\n                }\n                assetNameAsDir = assetNameAsDir + '/';\n                for (const indexEntry of serverConfig.autoIndex) {\n                    let assetKeyIndex = assetNameAsDir + indexEntry;\n                    const asset = kvAssetsIndex[assetKeyIndex];\n                    if (asset != null) {\n                        return asset;\n                    }\n                }\n            }\n        }\n        return null;\n    }\n    // A pedantic function that returns all content types that are requested for in the accept-encoding header that are\n    // accepted by the server config, grouped by descending order of q values.\n    // For example, if accept-encoding had br;q=1,gzip;q=0.5, and the server accepts both br and gzip,\n    // the result would be [['br'], ['gzip']]\n    async findAcceptEncodingsGroups(request) {\n        const serverConfig = await this.getServerConfig();\n        if (serverConfig == null || serverConfig.allowedEncodings.length === 0) {\n            return [];\n        }\n        const acceptEncodingHeader = request.headers.get('accept-encoding')?.trim() ?? '';\n        if (acceptEncodingHeader == '') {\n            return [];\n        }\n        const priorityMap = new Map;\n        for (const headerValue of acceptEncodingHeader.trim().split(',')) {\n            let [encodingValue, qValueStr] = headerValue.trim().split(';');\n            encodingValue = encodingValue.trim();\n            if (!serverConfig.allowedEncodings.includes(encodingValue)) {\n                continue;\n            }\n            let qValue; // q value multiplied by 1000\n            if (qValueStr == null || !qValueStr.startsWith('q=')) {\n                // use default of 1.0\n                qValue = 1000;\n            }\n            else {\n                qValueStr = qValueStr.slice(2); // remove the q=\n                qValue = parseFloat(qValueStr);\n                if (Number.isNaN(qValue) || qValue > 1) {\n                    qValue = 1;\n                }\n                if (qValue < 0) {\n                    qValue = 0;\n                }\n                // q values can have up to 3 decimal digits\n                qValue = Math.floor(qValue * 1000);\n            }\n            let typesForQValue = priorityMap.get(qValue);\n            if (typesForQValue == null) {\n                typesForQValue = [];\n                priorityMap.set(qValue, typesForQValue);\n            }\n            typesForQValue.push(encodingValue);\n        }\n        // Sort keys, larger numbers to come first\n        const keysSorted = [...priorityMap.keys()]\n            .sort((qValueA, qValueB) => qValueB - qValueA);\n        return keysSorted\n            .map(qValue => priorityMap.get(qValue));\n    }\n    async testExtendedCache(pathname) {\n        const staticItems = await this.getStaticItems();\n        return staticItems\n            .some(x => {\n            if (x instanceof RegExp) {\n                return x.test(pathname);\n            }\n            if (x.endsWith('/')) {\n                return pathname.startsWith(x);\n            }\n            return x === pathname;\n        });\n    }\n    handlePreconditions(request, asset, responseHeaders) {\n        // Handle preconditions according to https://httpwg.org/specs/rfc9110.html#rfc.section.13.2.2\n        // A recipient cache or origin server MUST evaluate the request preconditions defined by this specification in the following order:\n        // 1. When recipient is the origin server and If-Match is present, evaluate the If-Match precondition:\n        // - if true, continue to step 3\n        // - if false, respond 412 (Precondition Failed) unless it can be determined that the state-changing request has already succeeded (see Section 13.1.1)\n        // 2. When recipient is the origin server, If-Match is not present, and If-Unmodified-Since is present, evaluate the If-Unmodified-Since precondition:\n        // - if true, continue to step 3\n        // - if false, respond 412 (Precondition Failed) unless it can be determined that the state-changing request has already succeeded (see Section 13.1.4)\n        // 3. When If-None-Match is present, evaluate the If-None-Match precondition:\n        // - if true, continue to step 5\n        // - if false for GET/HEAD, respond 304 (Not Modified)\n        // - if false for other methods, respond 412 (Precondition Failed)\n        let skipIfNoneMatch = false;\n        {\n            const headerValue = getIfNoneMatchHeader(request);\n            if (headerValue.length > 0) {\n                const result = checkIfNoneMatch(responseHeaders.get('ETag'), headerValue);\n                if (result) {\n                    skipIfNoneMatch = true;\n                }\n                else {\n                    return new Response(null, {\n                        status: 304,\n                        headers: buildHeadersSubset(responseHeaders, headersToPreserveForUnmodified),\n                    });\n                }\n            }\n        }\n        // 4. When the method is GET or HEAD, If-None-Match is not present, and If-Modified-Since is present, evaluate the\n        // If-Modified-Since precondition:\n        // - if true, continue to step 5\n        // - if false, respond 304 (Not Modified)\n        if (!skipIfNoneMatch) {\n            // For us, method is always GET or HEAD here.\n            const headerValue = getIfModifiedSinceHeader(request);\n            if (headerValue != null) {\n                const result = checkIfModifiedSince(asset.lastModifiedTime, headerValue);\n                if (!result) {\n                    return new Response(null, {\n                        status: 304,\n                        headers: buildHeadersSubset(responseHeaders, headersToPreserveForUnmodified),\n                    });\n                }\n            }\n        }\n        // 5. When the method is GET and both Range and If-Range are present, evaluate the If-Range precondition:\n        // - if true and the Range is applicable to the selected representation, respond 206 (Partial Content)\n        // - otherwise, ignore the Range header field and respond 200 (OK)\n        // 6. Otherwise,\n        // - perform the requested method and respond according to its success or failure.\n        return null;\n    }\n    async loadKvAssetVariant(entry, variant) {\n        const kvStore = new KVStore(this.kvStoreName);\n        const baseHash = entry.key.slice(7);\n        const baseKey = `${this.publishId}_files_sha256_${baseHash}`;\n        const variantKey = variant != null ? `${baseKey}_${variant}` : baseKey;\n        const kvStoreEntry = await getKVStoreEntry(kvStore, variantKey);\n        if (kvStoreEntry == null) {\n            return null;\n        }\n        const metadataText = kvStoreEntry.metadataText() ?? '';\n        if (metadataText === '') {\n            return null;\n        }\n        let metadata;\n        try {\n            metadata = JSON.parse(metadataText);\n        }\n        catch {\n            return null;\n        }\n        if (!isKVAssetVariantMetadata(metadata)) {\n            return null;\n        }\n        if (metadata.size == null) {\n            return null;\n        }\n        return {\n            kvStoreEntry,\n            ...metadata,\n        };\n    }\n    async findKVAssetVariantForAcceptEncodingsGroups(entry, acceptEncodingsGroups = []) {\n        if (!entry.key.startsWith('sha256:')) {\n            throw new TypeError(`Key must start with 'sha256:': ${entry.key}`);\n        }\n        // Each encodingGroup is an array of Accept-Encodings that have the same q value,\n        // with the highest first\n        for (const encodingGroup of acceptEncodingsGroups) {\n            let smallestSize = undefined;\n            let smallestEntry = undefined;\n            for (const encoding of encodingGroup) {\n                if (!entry.variants.includes(encoding)) {\n                    continue;\n                }\n                const variantKvStoreEntry = await this.loadKvAssetVariant(entry, encoding);\n                if (variantKvStoreEntry == null) {\n                    continue;\n                }\n                if (smallestSize == null || variantKvStoreEntry.size < smallestSize) {\n                    smallestSize = variantKvStoreEntry.size;\n                    smallestEntry = variantKvStoreEntry;\n                }\n            }\n            if (smallestEntry != null) {\n                return smallestEntry;\n            }\n        }\n        const baseKvStoreEntry = await this.loadKvAssetVariant(entry, null);\n        if (baseKvStoreEntry == null) {\n            throw new TypeError('Key not found: ' + entry.key);\n        }\n        return baseKvStoreEntry;\n    }\n    async serveAsset(request, asset, init) {\n        const headers = new Headers(init?.headers);\n        headers.set('Content-Type', asset.contentType);\n        if (this.collectionNameHeader) {\n            headers.set(this.collectionNameHeader, this.activeCollectionName);\n            headers.append('Vary', this.collectionNameHeader);\n        }\n        if (init?.cache != null) {\n            let cacheControlValue;\n            switch (init.cache) {\n                case 'extended':\n                    cacheControlValue = 'max-age=31536000';\n                    break;\n                case 'never':\n                    cacheControlValue = 'no-store';\n                    break;\n            }\n            headers.append('Cache-Control', cacheControlValue);\n        }\n        const acceptEncodings = await this.findAcceptEncodingsGroups(request);\n        const kvAssetVariant = await this.findKVAssetVariantForAcceptEncodingsGroups(asset, acceptEncodings);\n        if (kvAssetVariant.contentEncoding != null) {\n            headers.append('Content-Encoding', kvAssetVariant.contentEncoding);\n        }\n        headers.set('ETag', `\"${kvAssetVariant.hash}\"`);\n        if (asset.lastModifiedTime !== 0) {\n            headers.set('Last-Modified', (new Date(asset.lastModifiedTime * 1000)).toUTCString());\n        }\n        const preconditionResponse = this.handlePreconditions(request, asset, headers);\n        if (preconditionResponse != null) {\n            return preconditionResponse;\n        }\n        const kvStoreEntry = kvAssetVariant.kvStoreEntry;\n        return new Response(kvStoreEntry.body, {\n            status: init?.status ?? 200,\n            headers,\n        });\n    }\n    async serveRequest(request) {\n        // Only handle GET and HEAD\n        if (request.method !== 'GET' && request.method !== 'HEAD') {\n            return null;\n        }\n        const url = new URL(request.url);\n        const pathname = decodeURI(url.pathname);\n        // Custom health check route\n        if (pathname === '/healthz') {\n            return new Response(\"OK\", { status: 200 });\n        }\n        const serverConfig = await this.getServerConfig();\n        if (serverConfig == null) {\n            return new Response(`Settings not found. You may need to publish your application.`, {\n                status: 500,\n                headers: {\n                    'content-type': 'text/plain',\n                },\n            });\n        }\n        const asset = await this.getMatchingAsset(serverConfig.publicDirPrefix + pathname, true);\n        if (asset != null) {\n            return this.serveAsset(request, asset, {\n                cache: await this.testExtendedCache(pathname) ? 'extended' : null,\n            });\n        }\n        // fallback HTML responses, like SPA and \"not found\" pages\n        if (requestAcceptsTextHtml(request)) {\n            const kvAssetsIndex = await this.getKvAssetsIndex();\n            if (kvAssetsIndex == null) {\n                return null;\n            }\n            // These are raw asset paths, not relative to public path\n            const { spaFile } = serverConfig;\n            if (spaFile != null) {\n                const asset = kvAssetsIndex[spaFile];\n                if (asset != null) {\n                    return this.serveAsset(request, asset, {\n                        cache: 'never',\n                    });\n                }\n            }\n            const { notFoundPageFile } = serverConfig;\n            if (notFoundPageFile != null) {\n                const asset = kvAssetsIndex[notFoundPageFile];\n                if (asset != null) {\n                    return this.serveAsset(request, asset, {\n                        status: 404,\n                        cache: 'never',\n                    });\n                }\n            }\n        }\n        return null;\n    }\n}\n", "/*\n * Generated by @fastly/compute-js-static-publish.\n */\n\n/** @type {import('@fastly/compute-js-static-publish').StaticPublishRc} */\nconst rc = {\n  kvStoreName: \"divine-web-content\",\n  publishId: \"default\",\n  defaultCollectionName: \"live\",\n  staticPublisherWorkingDir: \"./static-publisher\",\n};\n\nexport default rc;\n", "// ABOUTME: Fastly Compute entry point for divine-web static site\n// ABOUTME: Handles www redirects, external redirects, NIP-05 from KV, subdomain profiles, and SPA fallback\n\n/// <reference types=\"@fastly/js-compute\" />\nimport { env } from 'fastly:env';\nimport { KVStore } from 'fastly:kv-store';\nimport { PublisherServer } from '@fastly/compute-js-static-publish';\nimport rc from '../static-publish.rc.js';\n\nconst publisherServer = PublisherServer.fromStaticPublishRc(rc);\n\n// Apex domains we serve (used to detect subdomains)\nconst APEX_DOMAINS = ['dvine.video', 'divine.video'];\n\n// External redirects - always redirect to about.divine.video (Option A)\nconst EXTERNAL_REDIRECTS = {\n  '/press': { url: 'https://about.divine.video/press/', status: 301 },\n  '/news': { url: 'https://about.divine.video/news/', status: 301 },\n  '/media-resources': { url: 'https://about.divine.video/media-resources/', status: 301 },\n  '/news/vine-revisited': { url: 'https://about.divine.video/vine-revisited-a-return-to-the-halcyon-days-of-the-internet/', status: 301 },\n  '/discord': { url: 'https://discord.gg/sHb4HMSF', status: 302 },\n};\n\n// eslint-disable-next-line no-restricted-globals\naddEventListener(\"fetch\", (event) => event.respondWith(handleRequest(event)));\n\nasync function handleRequest(event) {\n  const version = env('FASTLY_SERVICE_VERSION');\n  console.log('FASTLY_SERVICE_VERSION', version);\n\n  const request = event.request;\n  const url = new URL(request.url);\n  \n  console.log('Request hostname:', url.hostname, 'path:', url.pathname);\n\n  // 1. Redirect www.* to apex domain (e.g., www.divine.video -> divine.video)\n  if (url.hostname.startsWith('www.')) {\n    const newUrl = new URL(url);\n    newUrl.hostname = url.hostname.slice(4); // remove 'www.'\n    return Response.redirect(newUrl.toString(), 301);\n  }\n\n  // 2. Check if this is a subdomain request (e.g., alice.dvine.video)\n  const subdomain = getSubdomain(url.hostname);\n  \n  if (subdomain) {\n    // Subdomain NIP-05 request\n    if (url.pathname === '/.well-known/nostr.json') {\n      console.log('Handling subdomain NIP-05 for:', subdomain);\n      try {\n        return await handleSubdomainNip05(subdomain);\n      } catch (err) {\n        console.error('Subdomain NIP-05 error:', err.message, err.stack);\n        return jsonResponse({ error: 'Handler error' }, 500);\n      }\n    }\n    \n    // Subdomain profile redirect (alice.dvine.video -> dvine.video/profile/npub...)\n    console.log('Handling subdomain profile for:', subdomain);\n    try {\n      return await handleSubdomainProfile(subdomain, url);\n    } catch (err) {\n      console.error('Subdomain profile error:', err.message, err.stack);\n      return new Response('Profile not found', { status: 404 });\n    }\n  }\n\n  // 3. Handle external redirects\n  const redirect = EXTERNAL_REDIRECTS[url.pathname];\n  if (redirect) {\n    return Response.redirect(redirect.url, redirect.status);\n  }\n\n  // 4. Handle NIP-05 requests from KV store (root domain)\n  if (url.pathname === '/.well-known/nostr.json') {\n    console.log('Handling NIP-05 request');\n    try {\n      return await handleNip05(url);\n    } catch (err) {\n      console.error('NIP-05 handler error:', err.message, err.stack);\n      return jsonResponse({ error: 'Handler error', details: err.message }, 500);\n    }\n  }\n\n  // 5. Serve static content with SPA fallback (handled by PublisherServer config)\n  const response = await publisherServer.serveRequest(request);\n  if (response != null) {\n    return response;\n  }\n\n  return new Response('Not Found', { status: 404 });\n}\n\n/**\n * Handle NIP-05 requests by looking up usernames in the divine-names KV store.\n * Returns JSON in NIP-05 format: { \"names\": { \"username\": \"pubkey\" }, \"relays\": { \"pubkey\": [...] } }\n */\nasync function handleNip05(url) {\n  const name = url.searchParams.get('name');\n  \n  // NIP-05 requires a name parameter\n  if (!name) {\n    return jsonResponse({ error: 'Name is required.' }, 400);\n  }\n\n  try {\n    const store = new KVStore('divine-names');\n    const entry = await store.get(`user:${name.toLowerCase()}`);\n    \n    if (!entry) {\n      // User not found - return empty names object per NIP-05\n      return jsonResponse({ names: {} });\n    }\n\n    const userData = JSON.parse(await entry.text());\n    \n    // Build NIP-05 response\n    const response = {\n      names: {\n        [name.toLowerCase()]: userData.pubkey\n      }\n    };\n\n    // Include relays if available\n    if (userData.relays && userData.relays.length > 0) {\n      response.relays = {\n        [userData.pubkey]: userData.relays\n      };\n    }\n\n    return jsonResponse(response);\n  } catch (error) {\n    console.error('NIP-05 KV error:', error);\n    return jsonResponse({ error: 'Internal server error' }, 500);\n  }\n}\n\n/**\n * Helper to create JSON responses with proper headers\n */\nfunction jsonResponse(data, status = 200) {\n  return new Response(JSON.stringify(data), {\n    status,\n    headers: {\n      'Content-Type': 'application/json',\n      'Access-Control-Allow-Origin': '*',\n      'Cache-Control': 'public, max-age=300', // Cache for 5 minutes\n    },\n  });\n}\n\n/**\n * Extract subdomain from hostname if it's a user subdomain.\n * Returns null for apex domains, www, or other reserved subdomains.\n */\nfunction getSubdomain(hostname) {\n  for (const apex of APEX_DOMAINS) {\n    if (hostname === apex) {\n      return null; // Apex domain, no subdomain\n    }\n    if (hostname.endsWith('.' + apex)) {\n      const subdomain = hostname.slice(0, -(apex.length + 1));\n      // Skip reserved subdomains\n      if (subdomain === 'www' || subdomain === 'admin' || subdomain === 'api') {\n        return null;\n      }\n      // Skip multi-level subdomains (e.g., names.admin.divine.video)\n      if (subdomain.includes('.')) {\n        return null;\n      }\n      return subdomain.toLowerCase();\n    }\n  }\n  return null; // Unknown domain\n}\n\n/**\n * Handle subdomain NIP-05 requests (e.g., alice.dvine.video/.well-known/nostr.json)\n * Returns { \"names\": { \"_\": \"pubkey\" }, \"relays\": { \"pubkey\": [...] } }\n */\nasync function handleSubdomainNip05(subdomain) {\n  const store = new KVStore('divine-names');\n  const entry = await store.get(`user:${subdomain}`);\n  \n  if (!entry) {\n    return new Response('Not Found', { status: 404 });\n  }\n\n  const userData = JSON.parse(await entry.text());\n  \n  if (userData.status !== 'active') {\n    return new Response('Not Found', { status: 404 });\n  }\n\n  // Build NIP-05 response with underscore name for subdomain format\n  const response = {\n    names: {\n      '_': userData.pubkey\n    }\n  };\n\n  // Include relays if available\n  if (userData.relays && userData.relays.length > 0) {\n    response.relays = {\n      [userData.pubkey]: userData.relays\n    };\n  }\n\n  return jsonResponse(response);\n}\n\n/**\n * Handle subdomain profile requests (e.g., alice.dvine.video/)\n * Redirects to the main app's profile page for that user.\n */\nasync function handleSubdomainProfile(subdomain, url) {\n  const store = new KVStore('divine-names');\n  const entry = await store.get(`user:${subdomain}`);\n  \n  if (!entry) {\n    return new Response('Profile not found', { status: 404 });\n  }\n\n  const userData = JSON.parse(await entry.text());\n  \n  if (userData.status !== 'active' || !userData.pubkey) {\n    return new Response('Profile not found', { status: 404 });\n  }\n\n  // Convert hex pubkey to npub for the profile URL\n  const npub = hexToNpub(userData.pubkey);\n  \n  // Find the apex domain from the current hostname\n  let apexDomain = 'dvine.video'; // default\n  for (const apex of APEX_DOMAINS) {\n    if (url.hostname.endsWith(apex)) {\n      apexDomain = apex;\n      break;\n    }\n  }\n\n  // Redirect to profile page\n  const profileUrl = `https://${apexDomain}/profile/${npub}`;\n  return Response.redirect(profileUrl, 302);\n}\n\n/**\n * Convert hex pubkey to npub (Bech32) format\n */\nfunction hexToNpub(hex) {\n  // Bech32 character set\n  const CHARSET = 'qpzry9x8gf2tvdw0s3jn54khce6mua7l';\n  \n  // Convert hex to 5-bit groups\n  const data = [];\n  for (let i = 0; i < hex.length; i += 2) {\n    data.push(parseInt(hex.slice(i, i + 2), 16));\n  }\n  \n  // Convert 8-bit to 5-bit\n  const converted = convertBits(data, 8, 5, true);\n  \n  // Compute checksum\n  const hrp = 'npub';\n  const checksumData = hrpExpand(hrp).concat(converted);\n  const checksum = createChecksum(checksumData);\n  \n  // Encode\n  let result = hrp + '1';\n  for (const b of converted.concat(checksum)) {\n    result += CHARSET[b];\n  }\n  \n  return result;\n}\n\nfunction convertBits(data, fromBits, toBits, pad) {\n  let acc = 0;\n  let bits = 0;\n  const result = [];\n  const maxv = (1 << toBits) - 1;\n  \n  for (const value of data) {\n    acc = (acc << fromBits) | value;\n    bits += fromBits;\n    while (bits >= toBits) {\n      bits -= toBits;\n      result.push((acc >> bits) & maxv);\n    }\n  }\n  \n  if (pad && bits > 0) {\n    result.push((acc << (toBits - bits)) & maxv);\n  }\n  \n  return result;\n}\n\nfunction hrpExpand(hrp) {\n  const result = [];\n  for (const c of hrp) {\n    result.push(c.charCodeAt(0) >> 5);\n  }\n  result.push(0);\n  for (const c of hrp) {\n    result.push(c.charCodeAt(0) & 31);\n  }\n  return result;\n}\n\nfunction polymod(values) {\n  const GEN = [0x3b6a57b2, 0x26508e6d, 0x1ea119fa, 0x3d4233dd, 0x2a1462b3];\n  let chk = 1;\n  for (const v of values) {\n    const top = chk >> 25;\n    chk = ((chk & 0x1ffffff) << 5) ^ v;\n    for (let i = 0; i < 5; i++) {\n      if ((top >> i) & 1) {\n        chk ^= GEN[i];\n      }\n    }\n  }\n  return chk;\n}\n\nfunction createChecksum(data) {\n  const values = data.concat([0, 0, 0, 0, 0, 0]);\n  const mod = polymod(values) ^ 1;\n  const result = [];\n  for (let i = 0; i < 6; i++) {\n    result.push((mod >> (5 * (5 - i))) & 31);\n  }\n  return result;\n}\n"],
  "mappings": "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",
  "names": ["asset"]
}
