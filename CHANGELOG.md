# Changelog

All notable changes to this project will be documented in this file.

## [Unreleased]
- **PERFORMANCE**: Fix slow profile page loading (20s → <1s)
  - Fixed Funnelcake API response parsing - profile data is nested under `profile`, `social`, `stats` objects
  - Removed circuit breaker checks that were blocking fast API requests
  - Removed expensive Nostr queries for profile stats (10,000+ events) - now uses Funnelcake stats
  - Reduced API timeout from 15s to 5s
  - Profile metadata always returns object (never undefined) so UI renders immediately
- **FEATURE**: NIP-05 validation with visual feedback
  - New `useNip05Validation` hook validates NIP-05 via .well-known/nostr.json
  - Shows loading spinner (grey) while validating
  - Shows checkmark (green) when validated
  - Shows strikethrough (grey) when invalid
  - Never shows unvalidated NIP-05 with checkmark
- **UI**: Profile shows truncated npub instead of generated placeholder names
  - Removed fake names like "MysticNebula950"
  - Shows `npub1xxx...xxxx` while loading, real name when available
- **FEATURE**: Funnelcake REST API integration for faster video loading
  - New `funnelcakeClient.ts` - REST API client with circuit breaker health tracking
  - New `funnelcakeTransform.ts` - transforms API responses to ParsedVideoData format
  - New `useInfiniteVideosFunnelcake` hook for paginated video feeds via REST
  - New `useVideoProvider` hook that auto-selects Funnelcake vs WebSocket based on relay
  - New `useVideoByIdFunnelcake` hook for fast single-video lookups on VideoPage
  - VideoPage now loads via REST first, falls back to WebSocket (faster initial load)
- **FEATURE**: Classic Viner profile stats
  - ProfileHeader now shows "Classic Vine Stats" section for users with migrated Vines
  - Displays original Vine loop counts (total loops from all videos)
  - Shows count of classic Vines from the original platform (2013-2017)
- **FEATURE**: Classic Viners row on Discovery page
  - New `ClassicVinersRow` component showing popular Vine creators
  - Horizontal scrollable avatars with links to creator profiles
  - Fetches from Funnelcake `/api/viners` endpoint with fallback to video extraction
- **IMPROVEMENT**: Video cards display cached author names/avatars from Funnelcake
  - Added `authorName` and `authorAvatar` fields to ParsedVideoData
  - VideoCard prefers real Nostr profile, falls back to cached Funnelcake data
  - Eliminates "MysticComet590" placeholder names for classic Viners
- **CONFIG**: Switch primary relay from relay.divine.video to relay.dvines.org
  - Updated PRIMARY_RELAY in relays.ts
  - Added relay.dvines.org to PROFILE_RELAYS for kind 0 profile queries
  - Added `hasFunnelcake()` and `getFunnelcakeUrl()` helpers for relay capability detection
- **BUGFIX**: Fix .well-known files (assetlinks.json, apple-app-site-association) returning 404 on divine.video
  - Added `_routes.json` to exclude `.well-known/*` from Pages Functions routing
  - Updated `functions/[[path]].ts` to pass through `.well-known` paths directly
  - Updated `divine-name-server` worker to pass through app deep linking files to Pages origin
- **UI**: Change default VideoCard layout to vertical (text below video) on all screen sizes
- **UI**: Rename "Verified" badge to "Human Made" with checkmark icon for ProofMode verified content
  - Updated ProofModeBadge to use custom no-AI/human-made icon
  - Updated VerifiedOnlyToggle label from "Verified" to "Human Made"
- **UI**: Move VineBadge ("V Archived") to upper right corner of video cards, consistent with ProofModeBadge positioning
- **BUGFIX**: Fix Classic Vines tab showing random new videos instead of archived Vines
  - Root cause: Relay doesn't support combining `#platform` tag filter with NIP-50 `search` parameter
  - Removed NIP-50 search from Classic/top queries; Vines now fetched by platform tag and sorted client-side by loop count
- **UI**: VideoCard layout improvements
  - Added `layout` prop for horizontal (Vine-style) vs vertical layouts
  - Video page now uses vertical layout with narrower click zones for better button accessibility
  - Reduced font sizes for better information density
- **BUGFIX**: Fix hashtag pages not loading content (e.g., `/hashtag/lol`)
  - Root cause: Relay doesn't support combining `#t` tag filter with NIP-50 `search` parameter
  - Removed NIP-50 search from hashtag queries; sorting now applied client-side for hashtag feeds
  - Added client-side sorting for hashtag feeds (top/hot/rising modes)
- **BUGFIX**: Fix multiple videos playing simultaneously
  - Fixed stale closure bug in `VideoPlaybackContext` visibility selection callback
  - Fixed pause logic in `VideoPlayer` to always pause inactive videos regardless of loading state
- **IMPROVEMENT**: Normalize hashtag tags to lowercase when publishing new videos for consistent querying
- **PERFORMANCE**: Dramatically improve perceived page load speed with deferred social metrics loading
  - Videos now render immediately with placeholders for reactions/comments
  - Social metrics (likes, reposts, comments) load progressively after render
  - First 3 videos load metrics immediately, rest load with staggered delays (progressive enhancement)
  - Reduces initial relay queries from ~100+ to ~20, improving time-to-first-video from 5.7s to <1s
  - New hook: `useDeferredVideoMetrics` for progressive data loading
  - Updated `useVideoSocialMetrics` and `useVideoUserInteractions` to support optional `enabled` flag
- Discovery routing: Add `/discovery/:tab` routes (hot, top, rising, new, hashtags) and default `/discovery` → `/discovery/new`. Sync tab state with URL.
- Performance metrics: Instrument recent feed with query/parse/total timings and first-render metric; expose logs via `window.performanceMonitor`.
- Modal/feed stability: Prevent layout/scroll jumps by reserving scrollbar gutter and disabling overflow anchoring on feed containers.
  - CSS: `html { scrollbar-gutter: stable both-edges; }`.
  - CSS: `.feed-root { overflow-anchor: none; }` and apply to `VideoFeed` wrappers.
- Comments UX: Optimistically increment comment count on post from comments modal.
  - `CommentsSection` → `onCommentPosted` callback.
  - `VideoCommentsModal` forwards callback.
  - `VideoCard` maintains `localCommentCount` and updates immediately.
- Add-to-List dialog: Surface discovery by showing public lists that already include the video (lazy-loaded, up to 6 with links).
- UI bugfix: Convert `Badge` to `forwardRef` to resolve React ref warning with Radix slots.
- Meta/security cleanup: Remove invalid `<meta http-equiv="X-Frame-Options">`; add `mobile-web-app-capable` meta. Server headers should set X-Frame-Options/CSP.
- Docs: Add `AGENTS.md` contributor guide.

## [Previous]
- Initial project setup and ongoing work (see git history).
